<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>versionedobj &mdash; versionedobj v0.2.6 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="versionedobj" href="modules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#" class="icon icon-home"> versionedobj
          </a>
              <div class="version">
                v0.2.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">versionedobj</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">versionedobj</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>versionedobj</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="versionedobj">
<h1><a class="toc-backref" href="#id1">versionedobj</a><a class="headerlink" href="#versionedobj" title="Permalink to this headline"></a></h1>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">versionedobj</a><ul>
<li class="toctree-l2"><a class="reference internal" href="versionedobj.html">versionedobj package</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="object-serialization-versioning-framework-for-python-3x">
<h1><a class="toc-backref" href="#id2">Object serialization &amp; versioning framework for python 3x</a><a class="headerlink" href="#object-serialization-versioning-framework-for-python-3x" title="Permalink to this headline"></a></h1>
<p><strong>versionedobj</strong> is a framework for creating complex python objects that can be
serialized/deserialized to and from strings, or dicts, or JSON files.</p>
<p><strong>versionedobj</strong> also provides a versioning mechanism, to track changes in object
structure across time, and to migrate between different object versions.</p>
<p>See <a class="reference external" href="https://eriknyquist.github.io/versionedobj/versionedobj.html">API documentation</a></p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title"><strong>Table of Contents</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#versionedobj" id="id1">versionedobj</a></p></li>
<li><p><a class="reference internal" href="#object-serialization-versioning-framework-for-python-3x" id="id2">Object serialization &amp; versioning framework for python 3x</a></p>
<ul>
<li><p><a class="reference internal" href="#installing" id="id3">Installing</a></p></li>
<li><p><a class="reference internal" href="#example-versionedobject-as-a-configuration-file" id="id4">Example– VersionedObject as a configuration file</a></p></li>
<li><p><a class="reference internal" href="#accessing-versioned-object-instance-attributes" id="id5">Accessing versioned object instance attributes</a></p></li>
<li><p><a class="reference internal" href="#iterating-over-versioned-object-instance-attributes" id="id6">Iterating over versioned object instance attributes</a></p></li>
<li><p><a class="reference internal" href="#filtering-serialization-deserialization-output" id="id7">Filtering serialization/deserialization output</a></p>
<ul>
<li><p><a class="reference internal" href="#whitelisting-by-field-name" id="id8">Whitelisting by field name</a></p></li>
<li><p><a class="reference internal" href="#blacklisting-by-field-name" id="id9">Blacklisting by field name</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrations-making-use-of-the-version-number" id="id10">Migrations: making use of the version number</a></p>
<ul>
<li><p><a class="reference internal" href="#example-scenario-part-1-you-have-created-a-beautiful-versioned-object" id="id11">Example scenario, part 1: you have created a beautiful versioned object</a></p></li>
<li><p><a class="reference internal" href="#example-scenario-part-2-you-update-your-software-modifying-the-versioned-object" id="id12">Example scenario, part 2: you update your software, modifying the versioned object</a></p></li>
<li><p><a class="reference internal" href="#uh-oh-you-have-a-problem" id="id13">Uh-oh, you have a problem…</a></p></li>
<li><p><a class="reference internal" href="#solution-migrations" id="id14">Solution– migrations!</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrations-migrating-an-unversioned-object" id="id15">Migrations: migrating an unversioned object</a></p></li>
<li><p><a class="reference internal" href="#migrations-decorator-for-migration-functions" id="id16">Migrations: decorator for migration functions</a></p></li>
<li><p><a class="reference internal" href="#validating-input-data-without-deserializing" id="id17">Validating input data without deserializing</a></p></li>
<li><p><a class="reference internal" href="#performance-stress-test-visualization" id="id18">Performance/stress test visualization</a></p></li>
<li><p><a class="reference internal" href="#contributions" id="id19">Contributions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#indices-and-tables" id="id20">Indices and tables</a></p></li>
</ul>
</div>
<div class="section" id="installing">
<h2><a class="toc-backref" href="#id3">Installing</a><a class="headerlink" href="#installing" title="Permalink to this headline"></a></h2>
<p>Install <code class="docutils literal notranslate"><span class="pre">versionedobj</span></code> using pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">versionedobj</span>
</pre></div>
</div>
</div>
<div class="section" id="example-versionedobject-as-a-configuration-file">
<h2><a class="toc-backref" href="#id4">Example– VersionedObject as a configuration file</a><a class="headerlink" href="#example-versionedobject-as-a-configuration-file" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObject</span>

<span class="k">class</span> <span class="nc">DisplayConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;windowed&quot;</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="s2">&quot;1920x1080&quot;</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="mf">0.66</span>

<span class="c1"># Populate class attributes to build your object</span>
<span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;v1.0.0&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;john smith&quot;</span>
    <span class="n">friend_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="s2">&quot;user3&quot;</span><span class="p">]</span>
    <span class="n">display_config</span> <span class="o">=</span> <span class="n">DisplayConfig</span><span class="p">()</span> <span class="c1"># VersionedObjects can be nested</span>

<span class="c1"># Create an instance of your object (instance attributes will match class attributes,</span>
<span class="c1"># and the initial values will be whatever values you set on the class attributes)</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">UserConfig</span><span class="p">()</span>

<span class="c1"># Change some values on the object instance</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">display_config</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;jane doe&quot;</span>

<span class="c1"># Save object instance to JSON file</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;user_config.json&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Load object instance from JSON file</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;user_config.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also save/load object data as a JSON string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj_as_json</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># Serialize to JSON string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj_as_json</span>                         <span class="c1"># Print JSON string</span>

<span class="go">{</span>
<span class="go">    &quot;version&quot;: &quot;v1.0.0&quot;,</span>
<span class="go">    &quot;username&quot;: &quot;jane doe&quot;,</span>
<span class="go">    &quot;friend_list&quot;: [</span>
<span class="go">            &quot;user1&quot;,</span>
<span class="go">            &quot;user2&quot;,</span>
<span class="go">            &quot;user3&quot;</span>
<span class="go">    ],</span>
<span class="go">    &quot;display_config&quot;: {</span>
<span class="go">        &quot;display_mode&quot;: &quot;windowed&quot;,</span>
<span class="go">        &quot;resolution&quot;: &quot;1920x1080&quot;,</span>
<span class="go">        &quot;volume&quot;: 1.0</span>
<span class="go">    }</span>
<span class="go">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cfg</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">obj_as_json</span><span class="p">)</span>          <span class="c1"># Load from JSON string</span>
</pre></div>
</div>
<p>Or, as a dict:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj_as_dict</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>   <span class="c1"># Serialize to dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj_as_dict</span>                   <span class="c1"># Print dict</span>

<span class="go">{&#39;version&#39;: &#39;1.0.0&#39;, &#39;username&#39;: &#39;jane doe&#39;, &#39;friend_list&#39;: [&#39;user1&#39;, &#39;user2&#39;, &#39;user3&#39;], &#39;display_config&#39;: {&#39;display_mode&#39;: &#39;windowed&#39;, &#39;resolution&#39;: &#39;1920x1080&#39;, &#39;volume&#39;: 1.0}}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cfg</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">obj_as_dict</span><span class="p">)</span>    <span class="c1"># Load from dict</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-versioned-object-instance-attributes">
<h2><a class="toc-backref" href="#id5">Accessing versioned object instance attributes</a><a class="headerlink" href="#accessing-versioned-object-instance-attributes" title="Permalink to this headline"></a></h2>
<p>When you create an instance of your VersionedObject class, the instance attributes
will be automatically populated to match the class attributes you have created:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObject</span>

<span class="k">class</span> <span class="nc">AccountInfo</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;john&quot;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="mi">11223344</span>

<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">ip_addr</span> <span class="o">=</span> <span class="s2">&quot;255.255.255.255&quot;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">account_info</span> <span class="o">=</span> <span class="n">AccountInfo</span><span class="p">()</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">ip_addr</span><span class="p">)</span>
<span class="c1"># &quot;255.255.255.255&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">account_info</span><span class="o">.</span><span class="n">user_name</span><span class="p">)</span>
<span class="c1"># &quot;john&quot;</span>

<span class="n">session</span><span class="o">.</span><span class="n">account_info</span><span class="o">.</span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;jane&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">account_info</span><span class="o">.</span><span class="n">user_name</span><span class="p">)</span>
<span class="c1"># &quot;jane&quot;</span>
</pre></div>
</div>
<p>Alternatively, you can treat a VersionedObject instance as a dict, and access
attributes by passing their full name as the key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;account_info.user_name&#39;</span><span class="p">])</span>
<span class="c1"># &quot;jane&quot;</span>

<span class="n">session</span><span class="p">[</span><span class="s1">&#39;account_info.user_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jack&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;account_info.user_name&#39;</span><span class="p">])</span>
<span class="c1"># &quot;jack&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="iterating-over-versioned-object-instance-attributes">
<h2><a class="toc-backref" href="#id6">Iterating over versioned object instance attributes</a><a class="headerlink" href="#iterating-over-versioned-object-instance-attributes" title="Permalink to this headline"></a></h2>
<p>If you want to enumerate all attribute names &amp; values on a versioned object instance,
you can use the <code class="docutils literal notranslate"><span class="pre">object_attributes()</span></code> method, which returns a generator for all instance
attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObject</span>

<span class="k">class</span> <span class="nc">AccountInfo</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;john&quot;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="mi">11223344</span>

<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">ip_addr</span> <span class="o">=</span> <span class="s2">&quot;255.255.255.255&quot;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">account_info</span> <span class="o">=</span> <span class="n">AccountInfo</span><span class="p">()</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">object_attributes</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">attr_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Output looks like this:</span>
<span class="c1">#</span>
<span class="c1"># ip_addr: 255.255.255.255</span>
<span class="c1"># port: 22</span>
<span class="c1"># account_info.user_name: john</span>
<span class="c1"># account_info.user_id: 11223344</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-serialization-deserialization-output">
<h2><a class="toc-backref" href="#id7">Filtering serialization/deserialization output</a><a class="headerlink" href="#filtering-serialization-deserialization-output" title="Permalink to this headline"></a></h2>
<div class="section" id="whitelisting-by-field-name">
<h3><a class="toc-backref" href="#id8">Whitelisting by field name</a><a class="headerlink" href="#whitelisting-by-field-name" title="Permalink to this headline"></a></h3>
<p>When serializing, if you only want to output certain fields, you can use the ‘only’
parameter to specify which fields should be output (effectively a whitelist by field name):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;user_config.json&#39;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;display_config.resolution&#39;</span><span class="p">])</span>

<span class="c1"># Output looks like this:</span>
<span class="c1">#</span>
<span class="c1"># {</span>
<span class="c1">#     &quot;version&quot;: &quot;v1.0.0&quot;,</span>
<span class="c1">#     &quot;username&quot;: &quot;jane doe&quot;,</span>
<span class="c1">#     &quot;display_config&quot;: {</span>
<span class="c1">#         &quot;resolution&quot;: &quot;1920x1080&quot;,</span>
<span class="c1">#     }</span>
<span class="c1"># }</span>
</pre></div>
</div>
<p>The same parameter can be used for de-serializing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;user_config.json&#39;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;display_config.display_mode&#39;</span><span class="p">])</span>

<span class="c1"># Only the &#39;display_config.display_mode&#39; field is loaded from the file</span>
</pre></div>
</div>
</div>
<div class="section" id="blacklisting-by-field-name">
<h3><a class="toc-backref" href="#id9">Blacklisting by field name</a><a class="headerlink" href="#blacklisting-by-field-name" title="Permalink to this headline"></a></h3>
<p>When serializing, if you <em>don’t</em> want to output certain fields, you can use the ‘ignore’
parameter to specify which fields should be excluded from output (effectively a blacklist
by field name):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;user_config.json&#39;</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;friend_list&#39;</span><span class="p">,</span> <span class="s1">&#39;display_config.volume&#39;</span><span class="p">])</span>

<span class="c1"># Output looks like this:</span>
<span class="c1">#</span>
<span class="c1"># {</span>
<span class="c1">#     &quot;version&quot;: &quot;v1.0.0&quot;,</span>
<span class="c1">#     &quot;username&quot;: &quot;jane doe&quot;,</span>
<span class="c1">#     &quot;display_config&quot;: {</span>
<span class="c1">#         &quot;display_mode&quot;: &quot;windowed&quot;,</span>
<span class="c1">#         &quot;resolution&quot;: &quot;1920x1080&quot;</span>
<span class="c1">#     }</span>
<span class="c1"># }</span>
</pre></div>
</div>
<p>The same parameter can be used for de-serializing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;user_config.json&#39;</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;friend_list&#39;</span><span class="p">])</span>

<span class="c1"># Every field except for the &#39;friend_list&#39; field is loaded from the file</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="migrations-making-use-of-the-version-number">
<h2><a class="toc-backref" href="#id10">Migrations: making use of the version number</a><a class="headerlink" href="#migrations-making-use-of-the-version-number" title="Permalink to this headline"></a></h2>
<p>A VersionedObject object can have a <code class="docutils literal notranslate"><span class="pre">version</span></code> attribute, which can be any object,
although it is typically a string (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;v1.2.3&quot;</span></code>). This version attribute can be
used to support migrations for older objects, in the event that you need to
change the format of your object.</p>
<div class="section" id="example-scenario-part-1-you-have-created-a-beautiful-versioned-object">
<h3><a class="toc-backref" href="#id11">Example scenario, part 1: you have created a beautiful versioned object</a><a class="headerlink" href="#example-scenario-part-1-you-have-created-a-beautiful-versioned-object" title="Permalink to this headline"></a></h3>
<p>Let’s take the same config file definition from the previous example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObject</span>

<span class="c1"># Nested config object</span>
<span class="k">class</span> <span class="nc">DisplayConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;windowed&quot;</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="s2">&quot;1920x1080&quot;</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="mf">0.66</span>

<span class="c1"># Top-level config object with another nested config object</span>
<span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;v1.0.0&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;john smith&quot;</span>
    <span class="n">friend_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="s2">&quot;user3&quot;</span><span class="p">]</span>
    <span class="n">display_config</span> <span class="o">=</span> <span class="n">DisplayConfig</span><span class="p">()</span>
</pre></div>
</div>
<p>Imagine you’ve already released this code out into the world. People are already
using it, and they have JSON files generated by your <code class="docutils literal notranslate"><span class="pre">UserConfig</span></code> class sitting
on their computers.</p>
</div>
<div class="section" id="example-scenario-part-2-you-update-your-software-modifying-the-versioned-object">
<h3><a class="toc-backref" href="#id12">Example scenario, part 2: you update your software, modifying the versioned object</a><a class="headerlink" href="#example-scenario-part-2-you-update-your-software-modifying-the-versioned-object" title="Permalink to this headline"></a></h3>
<p>Now, imagine you are making a new release of your software, and some new features
require you to make the following changes to your versioned object:</p>
<ul class="simple">
<li><p>remove the the <code class="docutils literal notranslate"><span class="pre">DisplayConfig.resolution</span></code> field entirely</p></li>
<li><p>change the name of <code class="docutils literal notranslate"><span class="pre">DisplayConfig.volume</span></code> to <code class="docutils literal notranslate"><span class="pre">DisplayConfig.volumes</span></code></p></li>
<li><p>change the value of <code class="docutils literal notranslate"><span class="pre">DisplayConfig.volumes</span></code> from a float to a list</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObject</span>

<span class="c1"># Nested config object</span>
<span class="k">class</span> <span class="nc">DisplayConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;windowed&quot;</span>
    <span class="c1"># &#39;resolution&#39; field is deleted</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.66</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="c1"># &#39;volume&#39; is now called &#39;volumes&#39;, and is a list</span>

<span class="c1"># Top-level config object with another nested config object</span>
<span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;v1.0.0&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;john smith&quot;</span>
    <span class="n">friend_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="s2">&quot;user3&quot;</span><span class="p">]</span>
    <span class="n">display_config</span> <span class="o">=</span> <span class="n">DisplayConfig</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="uh-oh-you-have-a-problem">
<h3><a class="toc-backref" href="#id13">Uh-oh, you have a problem…</a><a class="headerlink" href="#uh-oh-you-have-a-problem" title="Permalink to this headline"></a></h3>
<p>Right now, if you send this updated UserConfig class to your existing users, it will fail
to load their existing JSON files with version <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>, since those files will contain
the <code class="docutils literal notranslate"><span class="pre">DisplayConfig.resolution</span></code> field that we deleted in <code class="docutils literal notranslate"><span class="pre">v1.0.1</span></code>, and
<code class="docutils literal notranslate"><span class="pre">DisplayConfig.volume</span></code> will similarly be gone, having been replaced with
<code class="docutils literal notranslate"><span class="pre">DisplayConfig.volumes</span></code>. This situation is what migrations are for.</p>
</div>
<div class="section" id="solution-migrations">
<h3><a class="toc-backref" href="#id14">Solution– migrations!</a><a class="headerlink" href="#solution-migrations" title="Permalink to this headline"></a></h3>
<p>The solution is to:</p>
<ol class="arabic simple">
<li><p>Change the version number to something new, e.g. <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> becomes <code class="docutils literal notranslate"><span class="pre">v1.0.1</span></code></p></li>
<li><p>Write a migration function to transform <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> object data into <code class="docutils literal notranslate"><span class="pre">v1.0.1</span></code> object data</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObject</span>

<span class="c1"># Nested config object</span>
<span class="k">class</span> <span class="nc">DisplayConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;windowed&quot;</span>
    <span class="c1"># &#39;resolution&#39; field is deleted</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.66</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="c1"># &#39;volume&#39; is now called &#39;volumes&#39;, and is a list</span>

<span class="c1"># Top-level config object with another nested config object</span>
<span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;v1.0.1&quot;</span> <span class="c1"># Version has been updated to 1.0.1</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;john smith&quot;</span>
    <span class="n">friend_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="s2">&quot;user3&quot;</span><span class="p">]</span>
    <span class="n">display_config</span> <span class="o">=</span> <span class="n">DisplayConfig</span><span class="p">()</span>

<span class="c1"># Create the migration function for v1.0.0 to v1.0.1</span>
<span class="k">def</span> <span class="nf">migrate_100_to_101</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
    <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;display_config&#39;</span><span class="p">][</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span>        <span class="c1"># Delete resolution field</span>
    <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;display_config&#39;</span><span class="p">][</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>            <span class="c1"># Delete volume field</span>
    <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;display_config&#39;</span><span class="p">][</span><span class="s1">&#39;volumes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.66</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="c1"># Add defaults for new volume values</span>
    <span class="k">return</span> <span class="n">attrs</span>                                     <span class="c1"># Return modified data (important!)</span>

<span class="c1"># Add the migration function for v1.0.0 to v1.0.1</span>
<span class="n">UserConfig</span><span class="o">.</span><span class="n">add_migration</span><span class="p">(</span><span class="s2">&quot;v1.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;v1.0.1&quot;</span><span class="p">,</span> <span class="n">migrate_100_to_101</span><span class="p">)</span>
</pre></div>
</div>
<p>after you add the migration function and update the version to <code class="docutils literal notranslate"><span class="pre">v1.0.1</span></code>, JSON files
that are loaded and contain the version <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> will be automatically migrated to version
<code class="docutils literal notranslate"><span class="pre">v1.0.1</span></code> using the migration function you added.</p>
<p>The downside to this approach, is that you have to manually udpate the version number,
and write a new migration function, anytime the structure of your config data changes.</p>
<p>The upside, of course, is that you can relatively easily support migrating any older
version of your config file to the current version.</p>
<p>If you don’t need the versioning/migration functionality, just never change your version
number, or don’t create a <code class="docutils literal notranslate"><span class="pre">version</span></code> attribute on your <code class="docutils literal notranslate"><span class="pre">VersionedObject</span></code> classes.</p>
</div>
</div>
<div class="section" id="migrations-migrating-an-unversioned-object">
<h2><a class="toc-backref" href="#id15">Migrations: migrating an unversioned object</a><a class="headerlink" href="#migrations-migrating-an-unversioned-object" title="Permalink to this headline"></a></h2>
<p>You may run into a situation where you release an unversioned object, but then
later you need to make changes, and migrate an unversioned object to a versioned object.</p>
<p>This can be handled simply by passing “None” to the “add_migration()” method, for the
“from_version” parameter. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObj</span>

<span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;v1.1.0&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">friend_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">migrate_none_to_100</span><span class="p">(</span><span class="n">attrs</span><span class="p">);</span>
    <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;friend_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Add new &#39;friend_list&#39; field</span>
    <span class="k">return</span> <span class="n">attrs</span>

<span class="n">UserConfig</span><span class="o">.</span><span class="n">add_migration</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;v1.0.0&quot;</span><span class="p">,</span> <span class="n">migrate_none_to_100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="migrations-decorator-for-migration-functions">
<h2><a class="toc-backref" href="#id16">Migrations: decorator for migration functions</a><a class="headerlink" href="#migrations-decorator-for-migration-functions" title="Permalink to this headline"></a></h2>
<p>Instead of calling the <code class="docutils literal notranslate"><span class="pre">add_migration()</span></code> class method, you can instead use the
<code class="docutils literal notranslate"><span class="pre">versionedobj.migration</span></code> decorator on your migration function, if you wish:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObj</span><span class="p">,</span> <span class="n">migration</span>

<span class="k">class</span> <span class="nc">UserConfig</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;v1.0.1&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;john smith&quot;</span>
    <span class="n">friend_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nd">@migration</span><span class="p">(</span><span class="n">UserConfig</span><span class="p">,</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1.0&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">migrate_100_to_101</span><span class="p">(</span><span class="n">attrs</span><span class="p">);</span>
    <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;friend_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Add new &#39;friend_list&#39; field</span>
    <span class="k">return</span> <span class="n">attrs</span>
</pre></div>
</div>
</div>
<div class="section" id="validating-input-data-without-deserializing">
<h2><a class="toc-backref" href="#id17">Validating input data without deserializing</a><a class="headerlink" href="#validating-input-data-without-deserializing" title="Permalink to this headline"></a></h2>
<p>You may want to validate some serialized object data without actually deserializing
and loading the object values. You can use the <code class="docutils literal notranslate"><span class="pre">validate_dict</span></code> method for this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">versionedobj</span> <span class="kn">import</span> <span class="n">VersionedObject</span>

<span class="k">class</span> <span class="nc">Recipe</span><span class="p">(</span><span class="n">VersionedObject</span><span class="p">):</span>
    <span class="n">ingredient_1</span> <span class="o">=</span> <span class="s2">&quot;onions&quot;</span>
    <span class="n">ingredient_2</span> <span class="o">=</span> <span class="s2">&quot;tomatoes&quot;</span>
    <span class="n">ingredient_3</span> <span class="o">=</span> <span class="s2">&quot;garlic&quot;</span>

<span class="n">rcp</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">()</span>

<span class="n">rcp</span><span class="o">.</span><span class="n">validate_dict</span><span class="p">({</span><span class="s2">&quot;ingredient_1&quot;</span><span class="p">:</span> <span class="s2">&quot;celery&quot;</span><span class="p">,</span> <span class="s2">&quot;ingredient_2&quot;</span><span class="p">:</span> <span class="s2">&quot;carrots&quot;</span><span class="p">})</span>
<span class="c1"># Raises versionedobj.exceptions.InputValidationError because &#39;ingredient_3&#39; is missing</span>

<span class="n">rcp</span><span class="o">.</span><span class="n">validate_dict</span><span class="p">({</span><span class="s2">&quot;ingredient_1&quot;</span><span class="p">:</span> <span class="s2">&quot;celery&quot;</span><span class="p">,</span> <span class="s2">&quot;ingredient_2&quot;</span><span class="p">:</span> <span class="s2">&quot;carrots&quot;</span><span class="p">,</span> <span class="s2">&quot;ingredient_12&quot;</span><span class="p">:</span> <span class="s2">&quot;cumin&quot;</span><span class="p">})</span>
<span class="c1"># Raises versionedobj.exceptions.InputValidationError because &#39;ingredient_12&#39; is not a valid attribute</span>
</pre></div>
</div>
</div>
<div class="section" id="performance-stress-test-visualization">
<h2><a class="toc-backref" href="#id18">Performance/stress test visualization</a><a class="headerlink" href="#performance-stress-test-visualization" title="Permalink to this headline"></a></h2>
<p>The following image is generated by the <code class="docutils literal notranslate"><span class="pre">tests/performance_tests/big_class_performance_test.py</span></code> script,
which creates multiple versioned objects of increasing size.</p>
<p>The time taken to serialize each object to a dict, and also to deserialize the object data
from a dict, and also to create an instance of the object, is measured for each data point in
the graph (Note that measuring the <code class="docutils literal notranslate"><span class="pre">from/to_json</span></code> and <code class="docutils literal notranslate"><span class="pre">from/to_file</span></code> methods is not very
useful, since we’ll just be measuring <code class="docutils literal notranslate"><span class="pre">to/from_dict</span></code> with additional JSON parser or file I/O overhead).</p>
<p>Test executed on a system with an Intel Core-i7 running Debian GNU/Linux 10 (buster)
with Linux debian 4.19.0-21-amd64.</p>
<img alt="https://github.com/eriknyquist/versionedobj/raw/master/images/performance_graph.png" src="https://github.com/eriknyquist/versionedobj/raw/master/images/performance_graph.png" />
</div>
<div class="section" id="contributions">
<h2><a class="toc-backref" href="#id19">Contributions</a><a class="headerlink" href="#contributions" title="Permalink to this headline"></a></h2>
<p>Contributions are welcome, please open a pull request at <a class="reference external" href="https://github.com/eriknyquist/versionedobj">https://github.com/eriknyquist/versionedobj</a> and ensure that:</p>
<ol class="arabic simple">
<li><p>All existing unit tests pass (run tests via <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">test</span></code>)</p></li>
<li><p>New unit tests are added to cover any modified/new functionality</p></li>
</ol>
<p>If you have any questions about / need help with contributions or unit tests, please
contact Erik at <a class="reference external" href="mailto:eknyquist&#37;&#52;&#48;gmail&#46;com">eknyquist<span>&#64;</span>gmail<span>&#46;</span>com</a>.</p>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1><a class="toc-backref" href="#id20">Indices and tables</a><a class="headerlink" href="#indices-and-tables" title="Permalink to this headline"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules.html" class="btn btn-neutral float-right" title="versionedobj" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Erik K. Nyquist.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>